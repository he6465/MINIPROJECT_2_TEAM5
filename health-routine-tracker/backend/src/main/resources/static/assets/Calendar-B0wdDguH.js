import{u as k,g as C,r as g,Z as v,j as l,B as w,U as O}from"./index-CHXlbPyc.js";import{S as A}from"./Section-BYmvgxEJ.js";import{t as p,c as m,n as b,a as D,f,s as E}from"./format-Cc2PyARz.js";import{a as N}from"./addDays-Cugsopwf.js";import{s as F}from"./startOfMonth-xYZtRiky.js";function L(s,r,t){const e=p(s,t?.in);if(isNaN(r))return m(s,NaN);if(!r)return e;const i=e.getDate(),c=m(s,e.getTime());c.setMonth(e.getMonth()+r+1,0);const y=c.getDate();return i>=y?c:(e.setFullYear(c.getFullYear(),c.getMonth(),i),e)}function R(s){return m(s,Date.now())}function _(s,r,t){const[e,i]=b(t?.in,s,r);return+D(e)==+D(i)}function Y(s,r){const t=p(s,r?.in),e=t.getMonth();return t.setFullYear(t.getFullYear(),e+1,0),t.setHours(23,59,59,999),t}function I(s,r){const t=r?.weekStartsOn,e=p(s,r?.in),i=e.getDay(),c=(i<t?-7:0)+6-(i-t);return e.setDate(e.getDate()+c),e.setHours(23,59,59,999),e}function T(s,r,t){const[e,i]=b(t?.in,s,r);return e.getFullYear()===i.getFullYear()&&e.getMonth()===i.getMonth()}function z(s,r){return _(m(s,s),R(s))}function Z(){const s=k(),r=C(),[t,e]=g.useState(new Date),[i,c]=g.useState([]),y=Number(s.user?.id??1);g.useEffect(()=>{(async()=>{const n=f(t,"yyyy-MM");try{const o=await v(y,n),d=Array.isArray(o)?o:o?.days??[];c(d)}catch{c([])}})()},[t,y]),g.useEffect(()=>{const n=d=>{const a=d?.detail??void 0;a&&c(u=>u.some(h=>h.date===a)?u.map(h=>h.date===a?{...h,hasRoutine:!0}:h):[...u,{date:a,hasRoutine:!0}])},o=()=>{const d=f(t,"yyyy-MM");v(y,d).then(a=>{const u=Array.isArray(a)?a:a?.days??[];c(u)}).catch(()=>{})};return window.addEventListener("hrt:routine-created",n),window.addEventListener("focus",o),document.addEventListener("visibilitychange",o),()=>{window.removeEventListener("hrt:routine-created",n),window.removeEventListener("focus",o),document.removeEventListener("visibilitychange",o)}},[t,y]);const j=g.useMemo(()=>{const n=E(F(t),{weekStartsOn:0}),o=I(Y(t),{weekStartsOn:0}),d=[];for(let a=n;a<=o;a=N(a,1)){const u=f(a,"yyyy-MM-dd"),x=(Array.isArray(i)?i:[]).find(h=>h.date===u);d.push({d:a,info:x})}return d},[t,i]),M=n=>e(o=>L(o,n)),S=async n=>{const o=f(n,"yyyy-MM-dd");try{const{data:d}=await O.get("/routines",{params:{userId:y,from:o,to:o,page:1,size:1}}),a=d?.data?.content?.[0]?.id;r(a?`/posts/${a}`:"/posts/new")}catch{r("/posts/new")}};return l.jsx(A,{title:"달력",subtitle:"월간 루틴 한눈에 보기",children:l.jsxs("div",{className:"modern-card",style:{display:"grid",gap:16},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[l.jsx(w,{variant:"ghost",onClick:()=>M(-1),children:"<"}),l.jsx("strong",{children:f(t,"yyyy년 MM월")}),l.jsx(w,{variant:"ghost",onClick:()=>M(1),children:">"})]}),l.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, minmax(110px, 1fr))",gap:8,textAlign:"center",color:"#6b7280"},children:["일","월","화","수","목","금","토"].map(n=>l.jsx("div",{children:n},n))}),l.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, minmax(110px, 1fr))",gap:8},children:j.map(({d:n,info:o})=>{const d=T(n,t),a=z(n),u=o?.hasRoutine;return l.jsxs("button",{onClick:()=>S(n),className:"card",style:{padding:12,textAlign:"center",aspectRatio:"1 / 1",position:"relative",opacity:d?1:.5,borderColor:a?"var(--green-700)":"var(--color-border)",background:u?"rgba(38,155,97,0.15)":"var(--color-surface)"},"aria-label":f(n,"yyyy-MM-dd"),children:[l.jsx("div",{style:{fontSize:14,fontWeight:700},children:f(n,"d")}),u&&l.jsx("span",{"aria-hidden":!0,style:{position:"absolute",top:8,right:8,width:10,height:10,borderRadius:"999px",background:"var(--green-700)"}})]},n.toISOString())})})]})})}export{Z as default};
