import{j as e,L as T,a as L,u as N,r as C,B as x}from"./index-CaxNZczB.js";import{u as R}from"./queries-aMChE3g2.js";import{I as f}from"./Input-Bi7KADvw.js";import{S as I}from"./Select-CbxGWrl_.js";import{E as P}from"./State-L4pir3J1.js";import{S as q}from"./Section-CfAW0Fbr.js";function M(s,r){let o=[...s];if(r.from&&(o=o.filter(n=>n.date>=r.from)),r.to&&(o=o.filter(n=>n.date<=r.to)),r.exerciseType&&(o=o.filter(n=>n.exerciseType===r.exerciseType)),r.q&&r.q.trim()){const n=r.q.trim().toLowerCase();o=o.filter(c=>(c.meals??"").toLowerCase().includes(n)||(c.note??"").toLowerCase().includes(n))}const y=r.sort??"date_desc";o.sort((n,c)=>y==="date_desc"?c.date.localeCompare(n.date):n.date.localeCompare(c.date));const m=o.length,g=r.size,j=Math.max(1,Math.ceil(m/g)),u=Math.min(Math.max(1,r.page),j),h=(u-1)*g;return{content:o.slice(h,h+g),page:u,size:g,totalElements:m,totalPages:j}}function z({item:s}){return e.jsx(T,{to:`/posts/${s.id}`,className:"link-card",style:{textDecoration:"none"},children:e.jsxs("div",{className:"modern-card",style:{display:"grid",gap:10},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("strong",{children:s.date}),e.jsx("span",{className:"chip",children:s.exerciseType??"-"})]}),e.jsxs("div",{className:"muted",style:{fontSize:14},children:["수면 ",s.sleepHours??"-","h · 운동 ",s.exerciseMinutes??0,"분 · 물 ",s.waterMl??0,"ml"]}),s.meals&&e.jsx("div",{style:{color:"#111827"},children:s.meals.slice(0,120)})]})})}function b({width:s="100%",height:r=16}){return e.jsx("div",{style:{width:s,height:r,borderRadius:8,background:"linear-gradient(90deg, rgba(255,255,255,0.08), rgba(255,255,255,0.18), rgba(255,255,255,0.08))",backgroundSize:"200% 100%",animation:"skeleton 1.2s ease-in-out infinite"}})}function W(){const[s,r]=L(),o=s.get("userId"),y=o?Number(o):void 0,{data:m=[],isLoading:g}=R(y),u=N().user?.id,h=typeof u=="string"?parseInt(u,10):Number(u??0),v=()=>({page:Number(s.get("page")??1),size:Number(s.get("size")??20),sort:s.get("sort")??"date_desc",exerciseType:s.get("type")??"",from:s.get("from")??void 0,to:s.get("to")??void 0,q:s.get("q")??void 0}),[n,c]=C.useState(v());C.useEffect(()=>{c(v())},[s.toString()]);const d=C.useMemo(()=>M(m,n),[m,n]),p=a=>c(l=>{const t={...l,...a,page:a.page??l.page},i={};return t.page!==1&&(i.page=String(t.page)),t.size!==10&&(i.size=String(t.size)),t.sort&&(i.sort=String(t.sort)),t.exerciseType&&(i.type=String(t.exerciseType)),t.from&&(i.from=t.from),t.to&&(i.to=t.to),t.q&&(i.q=t.q),r(i,{replace:!0}),t});return e.jsxs(q,{title:"루틴 목록",subtitle:"필터를 조합해 원하는 기록만 보세요",children:[e.jsxs("div",{className:"modern-card",style:{display:"grid",gap:12},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"end",flexWrap:"wrap"},children:[e.jsx(f,{label:"사용자 ID",type:"number",value:o??"",onChange:a=>r(l=>{const t=new URLSearchParams(l),i=a.target.value;return i?t.set("userId",i):t.delete("userId"),t},{replace:!0})}),e.jsx(f,{label:"닉네임으로 찾기",placeholder:"예: hoo",onKeyDown:async a=>{if(a.key==="Enter"){const l=a.target.value.trim();if(!l){r(t=>{const i=new URLSearchParams(t);return i.delete("userId"),i},{replace:!0});return}try{const t=await fetch(`/v1/members/lookup?nickname=${encodeURIComponent(l)}`);if(t.ok){const i=await t.json(),S=i?.data?.id??i?.id;S&&r(k=>{const w=new URLSearchParams(k);return w.set("userId",String(S)),w},{replace:!0})}}catch{}}}}),e.jsx(x,{variant:"outline",onClick:()=>r(new URLSearchParams,{replace:!0}),children:"전체 보기"}),e.jsx(x,{variant:"ghost",onClick:()=>r(a=>{const l=new URLSearchParams(a);return h&&l.set("userId",String(h)),l},{replace:!0}),children:"내 루틴"}),e.jsx(x,{onClick:()=>p({page:1}),children:"적용"})]}),e.jsxs("div",{className:"filters-grid",style:{display:"grid",gridTemplateColumns:"repeat(5, minmax(160px, 1fr))",gap:12},children:[e.jsx(f,{label:"시작일",type:"date",value:n.from??"",onChange:a=>p({from:a.target.value,page:1})}),e.jsx(f,{label:"종료일",type:"date",value:n.to??"",onChange:a=>p({to:a.target.value,page:1})}),e.jsxs(I,{label:"운동 종류",value:n.exerciseType??"",onChange:a=>p({exerciseType:a.target.value,page:1}),children:[e.jsx("option",{value:"",children:"전체"}),e.jsx("option",{value:"WALK",children:"WALK"}),e.jsx("option",{value:"RUN",children:"RUN"}),e.jsx("option",{value:"GYM",children:"GYM"}),e.jsx("option",{value:"ETC",children:"ETC"})]}),e.jsxs(I,{label:"정렬",value:n.sort,onChange:a=>p({sort:a.target.value}),children:[e.jsx("option",{value:"date_desc",children:"날짜 내림차순"}),e.jsx("option",{value:"date_asc",children:"날짜 오름차순"})]}),e.jsx(f,{label:"검색",placeholder:"식사/메모 키워드",value:n.q??"",onChange:a=>p({q:a.target.value,page:1})})]})]}),g&&e.jsx("div",{style:{display:"grid",gap:12,gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))"},children:Array.from({length:6}).map((a,l)=>e.jsxs("div",{className:"card",style:{display:"grid",gap:8},children:[e.jsx(b,{width:"60%",height:20}),e.jsx(b,{width:"90%",height:14}),e.jsx(b,{width:"80%",height:14})]},l))}),!g&&d.content.length===0&&e.jsx(P,{message:"조건에 맞는 루틴이 없습니다."}),e.jsx("div",{style:{display:"grid",gap:12,gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))"},children:d.content.map(a=>e.jsx(z,{item:a},a.id))}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"center",marginTop:12,alignItems:"center"},children:[e.jsx(x,{variant:"outline",onClick:()=>p({page:Math.max(1,n.page-1)}),disabled:d.page===1,children:"이전"}),e.jsxs("span",{className:"muted",children:[d.page," / ",d.totalPages]}),e.jsx(x,{onClick:()=>p({page:Math.min(d.totalPages,n.page+1)}),disabled:d.page===d.totalPages,children:"다음"})]})]})}export{W as default};
